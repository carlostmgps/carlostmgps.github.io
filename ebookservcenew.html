<!DOCTYPE HTML>
<html>
    <head>
        <title>表單</title>
    </head>
    <body>
        <form>
            <h1>提交圖書</h1>
            <h2>書名</h2><input placeholder="書名" id="name">
            <h2>封面(jpg)</h2><input type="file" id="cover" name="avatar" accept="image/jpg"/>
            <h2>書本(pdf)</h2><input type="file" id="file" name="avatar" accept=".pdf" />
            <h2>介紹</h2><input placeholder="輸入介紹" id="info" />
            <a id="ok" href="#" onclick="add();return false;">提交</a>
            <button type="reset">重新填寫</button>
            
        </form>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-database.js"></script>

        <script>
          function add(){
            if(firebase.database().ref("書本").ref($("name").val()) == None){
                var book = {"pdf" : $("#file").val(),
                            "cover" : $("#cover").val(),
                            "介紹" : $("#info").val()}
                database = firebase.database()
                booksref = database.ref("書本").ref($("name").val())
                booksref.set(book);
                
                alert("成功新增！！");
            }else{
                alert("已有這本書!!");
            }
          };
          // Your web app's Firebase configuration
          // For Firebase JS SDK v7.20.0 and later, measurementId is optional
          var firebaseConfig = {
            apiKey: "AIzaSyAU2EDahAzGMoxBVpJcVAJA2RV0vauJfCs",
            authDomain: "ebook-sevice.firebaseapp.com",
            databaseURL: "https://ebook-sevice-default-rtdb.firebaseio.com",
            projectId: "ebook-sevice",
            storageBucket: "ebook-sevice.appspot.com",
            messagingSenderId: "907754964212",
            appId: "1:907754964212:web:ef1545aebd9f84562f8aa1",
            measurementId: "G-SNDHYVRCQ9"
          };
          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          firebase.analytics();
          firebase.auth().signInAnonymously()
            .then(() => {}
            .catch((error) => {
              var errorCode = error.code;
              var errorMessage = error.message;
              alert(errorMessage);
          });
          
        </script>
    </body>
</html>
